version: "3.3"
services:
  {{ env['CONTAINER'] }}:
    container_name: {{ env['CONTAINER'] }}
    image: {{ env['ECR_REGISTRY'] }}/{{ env['ECR_REPOSITORY'] }}:{{ env['IMAGE_TAG'] }} 
    ports:
      - {{ env['PORTS'] }}
    networks:
      - app-network
    logging:
      driver: loki
      options:
        loki-url: "http://loki:3100/loki/api/v1/push"

  grafana:
    container_name: grafana
    image: grafana/grafana:latest
    ports:
      - 3000:3000
    volumes:
      - grafana-data:/var/lib/grafana
    networks:
      - app-network
        
  loki:
    container_name: loki
    image: grafana/loki:latest
    ports:
      - 3100:3100
    volumes:
      - loki-data:/loki
    networks:
      - app-network

volumes:
  grafana-data:
  loki-data:

networks:
  app-network:
    driver: bridge
